% This document is part of the CoordinateFree project.
% Copyright 2022 the authors.

% Notes to selves:
% ----------------
% - We need to infer multiple geometric objects (multiple vectors say) per problem. But these might have different *units* as well as different directions and magnitudes. So I (DWH) think we want to explicitly include units in this project.
% George: Do we need a definition of representation Independences? What makes sense?


\documentclass{article}

% if you need to pass options to natbib, use, e.g.:
%     \PassOptionsToPackage{numbers, compress}{natbib}
% before loading neurips_2022

% ready for submission
\usepackage{neurips_2022}

% to compile a preprint version, e.g., for submission to arXiv, add add the
% [preprint] option:
%     \usepackage[preprint]{neurips_2022}

% to compile a camera-ready version, add the [final] option, e.g.:
%     \usepackage[final]{neurips_2022}

% to avoid loading the natbib package, add option nonatbib:
    %\usepackage[nonatbib]{neurips_2022}

\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography
\usepackage{xcolor}         % colors

% math packages and definitions
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tikz-cd}
\tikzcdset{every label/.append style = {font = \normalsize}}
\newcommand{\inv}{^{-1}}
\newcommand{\T}{^\top}
\newcommand{\R}{{\mathbb R}}
\newcommand{\surf}{{\mathrm{s}}}
\newcommand{\unit}[1]{\mathrm{#1}}
\newcommand{\kg}{\unit{kg}}
\newcommand{\m}{\unit{m}}
\newcommand{\s}{\unit{s}}

% text macros
\renewcommand{\paragraph}[1]{\par\textbf{#1}~---~}
\newcommand{\bernhard}[1]{~B: \textcolor{red}{\textbf{#1}}}

\title{Representation-agnostic physics, passive symmetries,\\ and equivariant machine learning}

% The \author macro works with any number of authors. There are two commands
% used to separate the names and addresses of multiple authors: \And and \AND.
%
% Using \And between authors leaves it to LaTeX to determine where to break the
% lines. Using \AND forces a line break at that point. So, if LaTeX puts 3 of 4
% authors names on the first line, and the last on the second line, try using
% \AND instead of \And before the third author name.

\author{%
  David S.~Hippocampus\thanks{Use footnote for providing further information
    about author (webpage, alternative address)---\emph{not} for acknowledging
    funding agencies.} \\
  Department of Computer Science\\
  Cranberry-Lemon University\\
  Pittsburgh, PA 15213 \\
  \texttt{hippo@cs.cranberry-lemon.edu} \\
  % examples of more authors
  % \And
  % Coauthor \\
  % Affiliation \\
  % Address \\
  % \texttt{email} \\
  % \AND
  % Coauthor \\
  % Affiliation \\
  % Address \\
  % \texttt{email} \\
  % \And
  % Coauthor \\
  % Affiliation \\
  % Address \\
  % \texttt{email} \\
  % \And
  % Coauthor \\
  % Affiliation \\
  % Address \\
  % \texttt{email} \\
}

\frenchspacing\sloppy\sloppypar\raggedbottom
\begin{document}

\maketitle

\paragraph{Abstract} 
There has been abundant work on making machine-learning methods exactly (or approximately) equivariant to group actions.
Equivariant functions obey relations like $f(g\cdot x) = g\cdot f(x)$; that is, if the inputs $x$ are transformed by group element $g$, then the outputs $f(x)$ are similarly transformed.
%Equivariance is the correct goal when the rules of the game have symmetries, or when the input--output relationship is desired to be invariant to group operations.
We emphasize that there are two different kinds of symmetries that can be encoded by these equivariances: active symmetries that are observed regularities in the laws of physics, and passive symmetries that arise from redundancies in the allowed representations of the physical objects. 
In the first category are the symmetries that lead to conservation of momentum, energy and angular momentum. In the second category are coordinate freedom, units equivariance, and gauge symmetry, among others.  
The passive symmetries always exist, even in situations in which the physical law is not actively symmetric.
For example the physics near the surface of the Earth is very strongly oriented (free objects fall in the down direction, usually), and yet the laws can be expressed in a perfectly coordinate-free way by making use of the local gravitational acceleration vector.
The passive symmetries seem trivial, but they can lead naturally to the discovery of geometric and dimensional quantities, even in very limited training data.
Our conjecture is that enforcing passive symmetries in the representations used for data in machine learning will improve generalization (both in and out of sample) in all areas in engineering and the natural sciences.

\section{Redundancy and passive symmetries}

In physics there are two types of symmetries: passive symmetries arising from the arbitrariness of the mathematical representation (including symmetries arising from coordinate freedoms and equivalences of reparameterizations) and active symmetries empirically established by observations and experiments (including the symmetries that imply the fundamental conservation laws, like momentum, energy, and angular momentum). Both of these symmetries can be expressed in terms of group actions and equivariances, but the epistemological content and range of applicability are very different. 

The redundancies in the representations and parameterizations of the world contain a large set of symmetries.
Mathematically, this can be formulated as invariances or equivariances with respect to changes of coordinates or parameterizations (see, eg, Section 4.1 of \cite{rovelli2000loop}).
These passive symmetries include gauge freedom, units covariance and general covariance.
These symmetries can be theoretically established with no need of observations, as they arise solely from the principle that the physical world acts independently of the mathematical choices we make to describe it.
The groups involved in coordinate freedom can be very large and complicated (eg, that of reparameterizations).

In contrast to the passive symmetries, the active symmetries of the Universe are the ones that must be established experimentally.
The laws of physics do not seem (at current precision) to depend on position, orientation, or time, which in turn imply conservation of momentum, angular momentum and energy according to Noether's Theorem \cite{noether} (because the Universe appears also to be Lagrangian).

Both passive and active symmetries can be illustrated by the commutative diagram in \eqref{eq.diagram}. The space $\mathcal X$ could be a world object, and $\Phi$ and $\Psi$ are encodings or representations of this object into a space $\mathcal H$ (here we mean representation in the broad sense, not the group theoretic notion, see next Section). Another interpretation of this diagram has $\mathcal X$ as a space of input data and $\mathcal H$ as the space of predictions.
\vspace{-1ex}%
\begin{equation}\label{eq.diagram}
\begin{tikzcd}[]
  {\cal X}\arrow[r,"\alpha"] \arrow[d,"\Phi",swap] & {\cal X}  \arrow[d,"\Psi"]\\
{\cal H} \arrow[r,"\beta"]  & {\cal H} 
\end{tikzcd}
\end{equation}
The passive diffeomorphisms are the transformations $\{\beta:\mathcal H \to \mathcal H\}$ where $\alpha$ is the taken to be the identity map, namely redundancies in the possible representations of the world that do not change the world (also known as covariances). The active symmetries the transformations $\{\beta:\mathcal H \to \mathcal H\}$ with non trivial $\alpha$ in the same diagram when $\Phi\equiv \Psi$.
Because of the indifference of the physical world to mathematicians' choices, all theories are invariant with respect passive diffeomorphisms.
Not all contain invariances with respect to active symmetries. 

When the transformations $\alpha$ and $\beta$ are actions by a certain group, then both active and passive symmetries can be expressed in terms of group equivariances. These group equivariances are useful for implementing machine learning models \cite{foo}. Equivariant machine learning models can predict properties and behaviour of physical systems (as argued in \cite{cheng2019covariance}), with the correct inductive bias, achieving smaller generalization error \cite{bietti2021sample, elesedy2021provably, elesedy2021kernel, mei2021learning} and allowing for out-of-distribution generalization \cite{villar2022dimensionless}. 
The non-trivial symmetries of general relativity have even been considered for machine learning \cite{weiler}.

Most importantly, imposing a passive symmetry on the structure of a machine-learning model can permit the discovery of potentially missing elements in the physical description of the problem. We illustrate these ideas with examples below, one in the context of units covariance, and one in the context of geometric coordinate freedom.
The passive symmetries are seemingly trivial statements about the world, but they lead to strong constraints on the laws of physics, and deliver scaling arguments that solve real physics problems.
They can constrain machine learning in valuable ways.
\emph{We conjecture that enforcing passive symmetries in machine-learning and data-analysis tasks will lead to generalization improvements in a wide range of circumstances.}
In particular, we make this conjecture even for problems in which no (or few) active symmetries are present.
After all, most problems (like reading handwriting or predicting gravitational trajectories near the surface of the Earth) are not equivariant to rotations, reflections, and translations, but they are all, in their data-generating processes, exactly and precisely coordinate free.

The goal of this note is to provide definitions for these concepts and to bolster the conjecture through a few examples.

\section{Definitions and terminology}

\paragraph{symmetry} Consider $V$ a vector space and $X\subseteq V$ a subset. Let $\mathcal T= \{ T:V\to V \}$ be a space of transformations of $V$. Then we say $X$ is \emph{symmetric} with respect to $\mathcal T$ if $T(X)=X$ for all $T\in \mathcal T$. For example, $X$ could be the sphere $X=\{x\in \mathbb R^3: \|x\|_2=1\}$ and $\mathcal T$ the space or rotations of $\mathbb R^3$ that fix the origin.

\paragraph{representation} There are at least three meanings of the word \emph{representation}. One is the approximate way we describe the world objects in either a physics model or a computer. The second meaning corresponds with the different mathematically equivalent ways one can express a mathematical object: for instance, a vector can be expressed in cartesian or polar coordinates. The third meaning is the \emph{representation of a group} $G$: an action $\rho: G\to \text{GL}(V)$ where $V$ is a vector space and $\text{GL}(V)$ denotes the space of invertible linear transformations from $V$ to itself. Note that representations of the group allow us to understand the group multiplication in terms of matrix multiplication.

\paragraph{equivariance}
Let $G$ be a group that acts on vector spaces $X$ and $Y$ as $\rho_X$ and $\rho_Y$ respectively. We say that function $f:X\to Y$ is \emph{equivariant} if for any group element $g\in G$ and any possible input $x$, the function obeys $f( \rho_X(g) x) = \rho_Y(g)\cdot f(x)$.

The actions of $G$ in $X$ and $Y$ induce an action on the space of maps from $X$ to $Y$. If $f\in \text{Maps(X,Y)}$ then $g\cdot f = \rho_Y(g)\circ f \circ \rho_X(g)^{-1}$. One can check that the equivariant maps are the fixed points of this action. This shows that equivariances define symmetries in the space of maps. 

\paragraph{invariance}
\emph{Invariance} is the special case of equivariance, where the action in the output space is trivial.

\paragraph{coordinate freedom}
When physical quantities are measured, or represented in a computer, they must be expressed in some coordinate system.
The redundancy of this representation---the fact that the investigator had many choices for the coordinate system---leads to a symmetry, which is known as \emph{coordinate freedom}.
It can be stated roughly as follows:
If the inputs to a physics problem are moved to a different coordinate system (because of a change in the origin or orientation), the outputs of the problem must be similarly moved.
The subject of coordinate freedom is most often discussed in the context of general relativity \cite{gr}, but in fact this symmetry appears in all of the laws of physics.

\paragraph{geometric principle}
One of the many consequences of coordinate freedom is that the laws of physics obey a \emph{geometric principle} \cite{mcp}, in which the laws of physics must be described in terms of scalars, vectors, and tensors (and their odd-parity partners pseudoscalars, pseudovectors, and pseudotensors).
These scalar, vector, and tensor quantities may only be combined in certain ways, encoded in detail by the Ricci--Levi-Civita (or Einstein) summation rules \cite{ricci, einsteinsummation}.
These considerations have recently been exploited in machine learning contexts \cite{villar2021scalars}.

\paragraph{covariance}
When physical law is written in a way that is consistent with invariance under \emph{passive diffeomorphisms} (as mentioned above), then the laws are sometimes said to be \emph{covariant}.

\paragraph{general covariance}
The covariance of relevance in general relativity \cite{einstein} is known as \emph{general covariance}.
Because general relativity is a theory in $3+1$ spacetime dimensions with a non-trivial spatially varying metric, this covariance is a very strong symmetry.
General covariance is sometimes called coordinate freedom, but it is a special case of coordinate freedom.

\paragraph{conservation law}
We say that a quantity obeys a \emph{conservation law} if changes in that quantity (with time) inside some small, closed volume can are quantitatively explained by fluxes of that quantity through the surface of that volume.
Famously, Emmy Noether connected invariants to conservation laws \cite{noether}.
Such results are not of direct relevance to what's being described in this contribution, because they are only relevant in the context of invariance with respect to \emph{active} transformations (not merely passive diffeomorphisms), and they are only relevant in systems that obey Lagrangian dynamics (or similar).

\paragraph{units} All physical quantities are measured with a system of what we call \emph{units}.
For example: A mass might be measured in $\kg$ or Solar masses.
An energy might be measured in joules or BTUs.
A quantity can be transformed from one unit system to another by multiplication by a dimensionless number (which, for example, might be the number of $\kg$ in a Solar mass.
Almost all quantities---including almost all scalars, vectors, and tensors---have units.

\paragraph{dimensions} The equivalence classes of quantities with units are called \emph{dimensions}.
For example, all quantities that have units that can be converted (by multiplication by a dimensionless number) to units of $\kg$ have dimensions of mass.
All quantities that can be similarly converted to units of joules have dimensions of energy.

\paragraph{units covariance} When physical quantities are measured, or represented in a computer, they must be measured in some unit system.
The redundancy of this representation---the fact that the investigator had many choices for the unit system---leads to a symmetry that underlies the method of ``dimensional analysis'':
The left-hand side and the right-hand side of any physical relation must have precisely the same units.
This symmetry is not trivial: It leads to important results (including some described below).

\paragraph{gauge freedom}
Some physical quantities in field theories (for example the vector potential in electromagnetism) have additional degrees of freedom that go beyond the choice of coordinate system and units.
These freedoms lead to additional symmetries which are known as gauge.

\section{Examples}

\paragraph{Free body in gravity}
Consider a mass $m$ near the surface of the Earth, in a location where the surface of the Earth can be considered as a horizontal plane, and close enough to the surface such that the gravitational field can be considered to be determined by a constant (not spatially varying) vector with magnitude $g$ and direction downwards.
\textsl{Question~1:}~If this mass $m$ is dropped (released at rest) from a small height $h$ from above the ground, how much time $T$ does it take to fall to the ground?
\textsl{Question~2:}~If this mass $m$ is launched from the surface at a low velocity of magnitude $v$ at an angle $\theta$ to the horizontal, how much horizontal distance $L$ will it fly before it hits the surface again?
Assume that the height $h$ and the velocity $v$ are both small enough that air resistance (ram pressure) can be ignored.

The answer to these questions, it turns out, are almost completely determined by dimensional (or units-covariance) arguments.
The mass $m$ has units of $\kg$, the gravitational acceleration magnitude $g$ has units of $\m\,\s^{-2}$, the velocity magnitude $v$ has units of $\m\,\s^{-1}$, the time $T$ has units of $\s$, and the lengths $h$ and $L$ have units of $\m$.
The angle $\theta$ is dimensionless (it can be measured in radians or degrees, say, which can be converted to radians by a dimensionless constant).
The only possible combination of $m, g, h$ that has units of time is $\alpha\,\sqrt{h/g}$, where $\alpha$ is a dimensionless constant, which doesn't depend on any of the inputs.
The only possible combination of $m, g, v, \theta$ that has units of length is $\beta(\theta)\,v^2/g$, where $\beta(\theta)$ is a dimensionless function of a dimensionless input.
That is, both Questions~1 and 2 can be answered up to a dimenionless constant (or function) without any considerations beyond the considerations of the units of the inputs and outputs.
And both of those answers don't depend in any way on the input mass $m$, which is the symmetry or invariance that led to the discovery of general relativity \cite{gr}.

This shows that the fundamental structure of physical law can be inferred from units covariance only, which is a passive symmetry.  Related ideas are explored more formally in \cite{villar2022dimensionless}.

\paragraph{Black-body radiation}
An important moment in the history of physics was the discovery by Planck that the electromagnetic radiation intensity $B_\lambda$ (energy per time per area per solid angle per wavelength) of thermal black-body radiation can be described with a simple equation \cite{planck}
\begin{equation}
    B_\lambda(\lambda) = \frac{2\,h\,c^2}{\lambda^5}\,\frac{1}{\exp\frac{h\,c}{\lambda\,k\,T} - 1}~,
\end{equation}
where $h$ is Planck's constant,
$c$ is the speed of light,
$\lambda$ is the wavelength of the electromagnetic radiation,
$k$ is Boltzmann's constant,
and $T$ is the temperature.
In finding this formula, Planck had to posit the existence (and units) of the constant $h=6.6\times 10^{-34}\,\kg\,\m^2\,\s^{-1}$ (his original value was presented with different units, but the same dimensions).
Prior to Planck's discovery and introduction of $h$, the only dimensionally acceptable expression for the black-body intensity was $B_\lambda(\lambda)=2\,c\,k\,T/\lambda^4$, which is the Rayleigh-Jeans Law, or the long-wavelength (infrared) or high-temperature limit of Planck's expression.
Planck's discovery was important because it solved the ``ultraviolet catastrophe'' of classical physics (the problem that thermal objects ought to have infinite heat capacity), and it seeded the theory of quantum mechanics, which is governed by Planck's constant $h$.

This problem can be solved almost directly with the passive symmetry of units covariance.
That is, the exponential cut-off of the intensity appears at a wavelength set by the temperature and a new constant, that must have units of action (or action times $c$, or action divided by $k$, or one of a set of other options.
We have shown (\url{https://github.com/foo/bar/}), with a simple toy training set, that no units-covariant regression for the intensity as a function of $\lambda, T, c, k$ can reproduce accurately the intensity $B_\lambda$, but that when the regression is permitted to introduce a new dimensional constant (but remain units covariant given the new constant), it finds a constant with units (and, less precisely, magnitude) that is consistent with $h$ (or $h$ times a combination of $c$ and $k$).
Again, this shows that the passive symmetry leads to powerful capability.

\paragraph{Springy double pendulum}
The double pendulum connected by springs in 3D is a toy example often used in equivariant machine learning demonstrations \cite{finzi2021practical; yao2021simple}. 
The final conditions (position and velocities of both masses after elapsed time $T$) are related to the initial conditions (position and velocities of the masses at the initial time).
The vectors are 3-dimensional, subject to a passive $O(3)$ equivariance, but the problem contains an \emph{active} $O(2)$ equivariance (the dynamics is equivariant with respect to rotations and reflections in the 2-d plane normal to gravity).
It is shown in \cite{yao2021simple} that when the problem is treated with a machine-learning method that is restricted to be coordinate free for the full passive $O(3)$ symmetry, training and generalization are improved over the case in which the method is restricted to be equivariant for the smaller active $O(2)$ symmetry.
That is, even though the dynamics of the double pendulum contains an explicit spatial anisotropy, the existence of the passive $O(3)$ symmetry is powerful for generalization.

\section{Discussion and other random notes}
BERNHARD: PLEASE MAKE SURE THAT THE POINTS YOU MAKE HERE APPEAR SOMEWHERE ABOVE. AND YOU AREN'T PERMITTED TO CHANGE THE LENGTH!!

Four special cases:
\begin{enumerate}
    \item the representation that retains dimensions but drops all numbers --- here the structure $\rho(g)$ is the graded algebra of dimensions...
    \item the representation that discards all dimensions and just describes transformations of numerical quantities
    \item a statistical representation --- here, $g$ could be 'prediction', and we may for instance want a $\Phi$ which makes prediction statistically or computationally easier
    \item a causal representation --- here, $g$ could be a class of interventions, possibly described by a group (e.g., translations of objects)
\end{enumerate}

xxx could also talk about equivariance with respect to sample size. Statistical inference procedures should be expressed s.t.\ they work independent of sample size

Approximate symmetries and representations that are approximate.

Any connection between this stuff and causality?
Example of cannon ball where influence of $m$ can be ruled out based on dimensional analysis --- write an SCM: (1) two variables are the initial values of $v$, $m$, chosen independently, and the final value of $l$ (2) $g$ is considered constant, (3) $\theta$ is the noise affecting $l$. From time constraints we know that the only possible causal arrows are from $v, m$ to $l$. From dimensional analysis, the arrow $m\to l$ is excluded, so we have identified the causal graph $v\to l$.

% \paragraph{Acknowledgments}
%Some of this work was performed at Schloss Dagstuhl seminar 22382 on Machine Learning in the Sciences in 2022 September.

\bibliographystyle{plain}
\raggedright
\bibliography{coordinatefree}
\end{document}
